<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Laporan Shift A â€” OEE Global</title>
  <style>
    :root{
      --bg:#f6f7f9; --card:#fff; --ink:#111827; --muted:#64748b; --line:#e5e7eb; --accent:#10b981; --danger:#ef4444;
    }
    body{font-family:system-ui,Segoe UI,Roboto,Arial; margin:0; background:var(--bg); color:var(--ink)}
    .wrap{max-width:960px;margin:24px auto;padding:16px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:14px;margin-bottom:12px}
    .grid-3{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
    .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    @media(max-width:640px){.grid-3,.grid-2{grid-template-columns:1fr}}
    label{display:block;font-weight:700;margin-bottom:4px}
    input,textarea,select{width:100%;padding:8px;border-radius:8px;border:1px solid var(--line);font:inherit}
    textarea{min-height:84px}
    .btn{padding:10px 14px;border-radius:8px;border:none;background:var(--accent);color:#fff;font-weight:700;cursor:pointer}
    .btn.ghost{background:transparent;border:1px solid var(--line);color:var(--ink)}
    .btn.danger{background:var(--danger)}
    pre{white-space:pre-wrap;background:#fff;border:1px dashed var(--line);padding:12px;border-radius:10px;min-height:120px}
    .oee-preview{display:flex;align-items:center;gap:12px;margin-top:8px}
    .oee-badge{background:#ecfdf5;color:#065f46;padding:6px 10px;border-radius:999px;font-weight:700}
    .bar{height:10px;border-radius:999px;background:#e5e7eb;flex:1;overflow:hidden}
    .bar span{height:100%;display:block;background:linear-gradient(90deg,#16a34a,#22c55e);width:0%}
    .muted{color:var(--muted);font-size:13px}
  </style>
</head>
<body>
<div class="wrap">
  <h2>Laporan Shift A â€” Final</h2>

  <div class="card">
    <div class="grid-3">
      <div><label>Tanggal</label><input type="date" id="tanggal"></div>
      <div><label>Nama Produk</label><input type="text" id="produk" value="PTWCJ-HLD-003"></div>
      <div><label>Shift</label>
        <select id="shift"><option>A</option><option>B</option><option>C</option></select>
      </div>
    </div>
  </div>

  <!-- LINE 2 -->
  <div class="card">
    <h3>LINE 2</h3>
    <div class="grid-3">
      <div><label>Pulp Tank 205</label><input id="pulp205_2" type="number"></div>
      <div><label>Vitacel A</label><input id="vit2a" type="number"></div>
      <div><label>Vitacel B</label><input id="vit2b" type="number"></div>
      <div><label>Vitacel Standby</label><input id="vit2s" type="number"></div>
      <div><label>Adhesive Standby</label><input id="adh2s" type="number"></div>
      <div><label>Adhesive Tangki</label><input id="adh2t" type="number"></div>
      <div><label>CMC</label><input id="cmc2" type="number"></div>
      <div><label>Recycle (set)</label><input id="rec2" type="number"></div>
      <div><label>Recycle per set (kg)</label><input id="rec2w" type="number"></div>
      <div><label>Mother Roll</label><input id="mr2" type="number"></div>
      <div><label>Berat FG (kg)</label><input id="fg2" type="number"></div>
    </div>
    <div class="grid-2" style="margin-top:10px">
      <div><label>Jumlah MR (Slitting)</label><input id="slit_mr2" type="number"><div class="muted">1 MR=6 bobin</div></div>
      <div><label>Reject Produksi (pcs)</label><input id="reject_produksi2" type="number">
           <label>Reject NCP (pcs)</label><input id="reject_ncp2" type="number"></div>
    </div>
    <div class="oee-preview"><div class="oee-badge" id="oee2">-</div><div class="bar"><span id="bar2"></span></div></div>
  </div>

  <!-- LINE 3 -->
  <div class="card">
    <h3>LINE 3</h3>
    <div class="grid-3">
      <div><label>Pulp Tank 204</label><input id="pulp204_3" type="number"></div>
      <div><label>Vitacel A</label><input id="vit3a" type="number"></div>
      <div><label>Vitacel B</label><input id="vit3b" type="number"></div>
      <div><label>Vitacel Standby</label><input id="vit3s" type="number"></div>
      <div><label>Adhesive Standby</label><input id="adh3s" type="number"></div>
      <div><label>Adhesive Tangki</label><input id="adh3t" type="number"></div>
      <div><label>CMC</label><input id="cmc3" type="number"></div>
      <div><label>Recycle (set)</label><input id="rec3" type="number"></div>
      <div><label>Recycle per set (kg)</label><input id="rec3w" type="number"></div>
      <div><label>Mother Roll</label><input id="mr3" type="number"></div>
      <div><label>Berat FG (kg)</label><input id="fg3" type="number"></div>
    </div>
    <div class="grid-2" style="margin-top:10px">
      <div><label>Jumlah MR (Slitting)</label><input id="slit_mr3" type="number"><div class="muted">1 MR=6 bobin</div></div>
      <div><label>Reject Produksi (pcs)</label><input id="reject_produksi3" type="number">
           <label>Reject NCP (pcs)</label><input id="reject_ncp3" type="number"></div>
    </div>
    <div class="oee-preview"><div class="oee-badge" id="oee3">-</div><div class="bar"><span id="bar3"></span></div></div>
  </div>

  <div class="card">
    <div class="grid-2">
      <div><label>Pulp Standby 203</label><input id="pulp203" type="number"></div>
      <div><label>Catatan</label><textarea id="catatan"></textarea></div>
    </div>
  </div>

  <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px">
    <button class="btn" onclick="previewLaporan()">Tampilkan</button>
    <button class="btn ghost" onclick="copyText()">Salin</button>
  </div>

  <div class="card"><pre id="output"></pre></div>
</div>

<script>
const SPEED=15, WIDTH=1.2, GSM=0.095, TIME=480, KG_PER_BOBIN=15, MR2BOB=6;
const nf=new Intl.NumberFormat('id-ID',{maximumFractionDigits:2});

function g(id){return document.getElementById(id).value;}
function n(id){return parseFloat(g(id))||0;}
function isFilledLine(line){
  return ["pulp205_"+line,"pulp204_"+line,"vit"+line+"a","vit"+line+"b","vit"+line+"s",
          "adh"+line+"s","adh"+line+"t","cmc"+line,"rec"+line,"rec"+line+"w","mr"+line,
          "fg"+line,"slit_mr"+line,"reject_produksi"+line,"reject_ncp"+line]
    .some(id=>document.getElementById(id)&&g(id)!=="");
}
function computeOEE(total,good){
  const actKg=total*KG_PER_BOBIN, theo=SPEED*WIDTH*GSM*TIME;
  const perf=theo>0?actKg/theo:0, qual=total>0?good/total:0;
  return perf*qual*100;
}
function lineReport(line){
  if(!isFilledLine(line)) return "";
  let t=`\n\n---\n\nLINE ${line}\n`;
  if(n("pulp205_"+line)||n("pulp204_"+line))t+=`- Pulp Tank: ${n("pulp205_"+line)||n("pulp204_"+line)} set\n`;
  if(n("vit"+line+"a"))t+=`- Vitacel A: ${n("vit"+line+"a")} set\n`;
  if(n("vit"+line+"b"))t+=`- Vitacel B: ${n("vit"+line+"b")} set\n`;
  if(n("vit"+line+"s"))t+=`- Vitacel Standby: ${n("vit"+line+"s")} set\n`;
  if(n("adh"+line+"s"))t+=`- Adhesive Standby: ${n("adh"+line+"s")} set\n`;
  if(n("adh"+line+"t"))t+=`- Adhesive Tangki: ${n("adh"+line+"t")} set\n`;
  if(n("cmc"+line))t+=`- CMC: ${n("cmc"+line)} set\n`;
  if(n("rec"+line)&&n("rec"+line+"w"))t+=`- Recycle: ${n("rec"+line)} set (${n("rec"+line+"w")} kg/set)\n`;
  if(n("mr"+line))t+=`- Mother Roll: ${n("mr"+line)} MR\n`;
  if(n("fg"+line))t+=`- Berat FG: ${n("fg"+line)} kg\n`;
  const mr=n("slit_mr"+line), total=mr*MR2BOB, rp=n("reject_produksi"+line), rn=n("reject_ncp"+line), good=Math.max(total-rp-rn,0);
  if(total>0){
    t+=`\nSlitting:\n- Slitting: ${total} bobin\n`;
    if(rp>0)t+=`- Reject Produksi: ${rp} bobin\n`;
    if(rn>0)t+=`- Reject NCP: ${rn} bobin\n`;
    t+=`- OKE: ${good} bobin (${good*KG_PER_BOBIN} kg)\n`;
    t+=`\nðŸ“ˆ OEE: ${nf.format(computeOEE(total,good))}%\n`;
  }
  return t;
}
function previewLaporan(){
  let isi=`LAPORAN SHIFT ${g("shift")}\nTanggal: ${g("tanggal")}\nProduk: ${g("produk")}`;
  isi+=lineReport(2);
  isi+=lineReport(3);
  if(n("pulp203")||g("catatan")){
    isi+=`\n\nCatatan Tambahan:\n`;
    if(n("pulp203"))isi+=`- Pulp 203: ${n("pulp203")} set\n`;
    if(g("catatan"))isi+=`- ${g("catatan")}\n`;
  }
  document.getElementById("output").innerText=isi;
  // reset OEE badge jika kosong
  [2,3].forEach(line=>{
    const badge=document.getElementById("oee"+line), bar=document.getElementById("bar"+line);
    if(!isFilledLine(line)){badge.textContent="-";bar.style.width="0%";}
    else {
      const mr=n("slit_mr"+line), total=mr*MR2BOB, good=Math.max(total-n("reject_produksi"+line)-n("reject_ncp"+line),0);
      const oee=computeOEE(total,good);badge.textContent=nf.format(oee)+"%";bar.style.width=Math.min(oee,100)+"%";
    }
  });
}
function copyText(){
  let t=document.getElementById("output").innerText;
  if(!t.trim()){alert("Laporan kosong!");return;}
  navigator.clipboard.writeText(t).then(()=>alert("Disalin"));
}
</script>
</body>
</html>
