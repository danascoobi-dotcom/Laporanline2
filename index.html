<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Laporan Shift A (Final)</title>
  <style>
    :root{
      --bg:#f6f7f9; --card:#ffffff; --ink:#1f2937; --muted:#64748b; --line:#e5e7eb; --accent:#25d366; --danger:#ef4444;
    }
    .dark{
      --bg:#0f1115; --card:#141821; --ink:#e5e7eb; --muted:#a0aec0; --line:#2d3748;
    }
    *{box-sizing:border-box}
    body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial; background:var(--bg); color:var(--ink);}
    .wrap{max-width:900px; margin:24px auto; padding:16px;}
    h2{margin:0 0 12px}
    .card{background:var(--card); border:1px solid var(--line); border-radius:12px; padding:16px; box-shadow:0 1px 2px rgba(0,0,0,.04)}
    label{font-weight:600; display:block; margin-top:10px}
    .hint{font-size:12px; color:var(--muted); margin-top:4px}
    input, textarea, select{
      width:100%; padding:10px 12px; margin-top:6px; border-radius:10px; border:1px solid var(--line); background:#fff; font:inherit;
    }
    textarea{min-height:84px; resize:vertical}
    .grid-2{display:grid; grid-template-columns:1fr 1fr; gap:12px}
    .grid-3{display:grid; grid-template-columns:repeat(3,1fr); gap:12px}
    @media (max-width:640px){ .grid-2, .grid-3{grid-template-columns:1fr} }
    .btn{
      display:inline-flex; align-items:center; justify-content:center; gap:8px;
      padding:10px 14px; border-radius:8px; border:1px solid var(--line); background:var(--accent); color:#fff; font-weight:700; cursor:pointer;
    }
    .btn.secondary{background:#111827}
    .btn.danger{background:var(--danger)}
    .btn.ghost{background:transparent; color:var(--ink)}
    .stack{display:grid; gap:12px}
    pre{
      background:#fff; border:1px dashed var(--line); border-radius:12px; padding:14px; white-space:pre-wrap; min-height:140px;
    }
    .oee-preview{margin-top:10px; padding:10px; background:#fff; border:1px dashed var(--line); border-radius:10px; font-size:14px}
    .bar{height:10px; border-radius:999px; overflow:hidden; background:#e5e7eb; margin-top:4px;}
    .bar span{display:block; height:100%; background:linear-gradient(90deg,#16a34a,#22c55e); width:0%;}
    .muted{font-size:12px; color:var(--muted)}
  </style>
</head>
<body>
<div class="wrap">
  <h2>Laporan Shift A â€“ Final</h2>
  <div class="stack">
    <div class="grid-3">
      <div>
        <label>Tanggal</label>
        <input type="date" id="tanggal">
      </div>
      <div>
        <label>Nama Produk</label>
        <input type="text" id="produk" value="PTWCJ-HLD-003">
      </div>
      <div>
        <label>Shift</label>
        <select id="shift">
          <option value="A">A</option>
          <option value="B">B</option>
          <option value="C">C</option>
        </select>
      </div>
    </div>

    <!-- LINE 2 -->
    <div class="card">
      <h3>LINE 2</h3>
      <div class="grid-3">
        <div><label>Pulp Tank 205</label><input type="number" id="pulp205_2"></div>
        <div><label>Vitacel Mix A</label><input type="number" id="vit2a"></div>
        <div><label>Vitacel Mix B</label><input type="number" id="vit2b"></div>
        <div><label>Vitacel Standby</label><input type="number" id="vit2s"></div>
        <div><label>Adhesive Standby</label><input type="number" id="adh2s"></div>
        <div><label>Adhesive di Tangki</label><input type="number" id="adh2t"></div>
        <div><label>CMC</label><input type="number" id="cmc2"></div>
        <div><label>Recycle (set)</label><input type="number" id="rec2"></div>
        <div><label>Recycle per set (kg)</label><input type="number" id="rec2w"></div>
        <div><label>Mother Roll</label><input type="number" id="mr2"></div>
        <div><label>Total Berat FG (kg)</label><input type="number" id="fg2"></div>
      </div>
      <div class="grid-2">
        <div><label>Jumlah MR (Slitting)</label><input type="number" id="slit_mr2"><div class="hint">1 MR = 6 bobin</div></div>
        <div><label>Bobin Reject Produksi (pcs)</label><input type="number" id="reject_produksi2"></div>
        <div><label>Bobin Reject NCP (pcs)</label><input type="number" id="reject_ncp2"></div>
        <div><label>Total Bobin Manual (pcs)</label><input type="number" id="total_bobin_manual2"><div class="hint">1 bobin = 15 kg</div></div>
      </div>
      <div class="oee-preview">
        ðŸ“ˆ OEE Line 2: <b><span id="oee2">-</span></b> <span class="muted" id="delta2"></span>
        <div class="bar"><span id="bar2"></span></div>
      </div>
    </div>

    <!-- LINE 3 -->
    <div class="card">
      <h3>LINE 3</h3>
      <div class="grid-3">
        <div><label>Pulp Tank 204</label><input type="number" id="pulp204_3"></div>
        <div><label>Vitacel Mix A</label><input type="number" id="vit3a"></div>
        <div><label>Vitacel Mix B</label><input type="number" id="vit3b"></div>
        <div><label>Vitacel Standby</label><input type="number" id="vit3s"></div>
        <div><label>Adhesive Standby</label><input type="number" id="adh3s"></div>
        <div><label>Adhesive di Tangki</label><input type="number" id="adh3t"></div>
        <div><label>CMC</label><input type="number" id="cmc3"></div>
        <div><label>Recycle (set)</label><input type="number" id="rec3"></div>
        <div><label>Recycle per set (kg)</label><input type="number" id="rec3w"></div>
        <div><label>Mother Roll</label><input type="number" id="mr3"></div>
        <div><label>Total Berat FG (kg)</label><input type="number" id="fg3"></div>
      </div>
      <div class="grid-2">
        <div><label>Jumlah MR (Slitting)</label><input type="number" id="slit_mr3"><div class="hint">1 MR = 6 bobin</div></div>
        <div><label>Bobin Reject Produksi (pcs)</label><input type="number" id="reject_produksi3"></div>
        <div><label>Bobin Reject NCP (pcs)</label><input type="number" id="reject_ncp3"></div>
        <div><label>Total Bobin Manual (pcs)</label><input type="number" id="total_bobin_manual3"><div class="hint">1 bobin = 15 kg</div></div>
      </div>
      <div class="oee-preview">
        ðŸ“ˆ OEE Line 3: <b><span id="oee3">-</span></b> <span class="muted" id="delta3"></span>
        <div class="bar"><span id="bar3"></span></div>
      </div>
    </div>

    <!-- Footer -->
    <div class="card">
      <div class="grid-2">
        <div><label>Pulp Standby Tank 203</label><input type="number" id="pulp203"></div>
        <div><label>Catatan untuk Shift Selanjutnya</label><textarea id="catatan"></textarea></div>
      </div>
    </div>

    <div class="grid-2">
      <button class="btn" onclick="previewLaporan()">Tampilkan Laporan</button>
      <button class="btn secondary" onclick="copyText()">Salin Teks</button>
      <button class="btn ghost" onclick="shareWA()">Kirim WA</button>
      <button class="btn ghost" onclick="exportCSV()">Export CSV</button>
      <button class="btn ghost" onclick="window.print()">Print/PDF</button>
      <button class="btn danger" onclick="clearData()">Bersihkan Data</button>
      <button class="btn ghost" onclick="toggleTheme()">ðŸŒ™ Mode</button>
    </div>

    <pre id="output"></pre>
  </div>
</div>

<script>
const BOBIN_PER_MR = 6, KG_PER_BOBIN = 15, SPEED = 15, WIDTH = 1.2, GSM = 0.095, TIME = 480;
const THEORETICAL_KG = SPEED*WIDTH*GSM*TIME;
const nf = new Intl.NumberFormat('id-ID',{maximumFractionDigits:2});
function g(id){let e=document.getElementById(id); return e&&e.value!==''?e.value:''}
function n(id){return parseFloat(g(id))||0}
function isFilled(ids){return ids.some(id=>g(id)!=='')}
function calcOEE(line){
  let totalMR=n(`slit_mr${line}`)*BOBIN_PER_MR, reject=n(`reject_produksi${line}`);
  let oke=Math.max(totalMR-reject,0)*KG_PER_BOBIN;
  return oke<=0?null:(oke/THEORETICAL_KG)*100
}
function updateOEE(line){
  let oee=calcOEE(line), el=document.getElementById(`oee${line}`), bar=document.getElementById(`bar${line}`);
  el.textContent=oee===null?'-':nf.format(oee)+'%';
  bar.style.width=oee?Math.min(oee,100)+'%':'0%';
  let prev=parseFloat(localStorage.getItem(`oeePrev${line}`)||'NaN');
  document.getElementById(`delta${line}`).textContent=isNaN(prev)||oee===null?'':`(${oee-prev>=0?'+':''}${nf.format(oee-prev)}% dari terakhir)`;
  if(oee!==null)localStorage.setItem(`oeePrev${line}`,oee);
}
["2","3"].forEach(l=>["slit_mr","reject_produksi"].forEach(k=>{
  let e=document.getElementById(`${k}${l}`); if(e)e.addEventListener("input",()=>updateOEE(l))
}));
function narasi(no,ids){
  let [pulp,vitA,vitB,vitS,adhS,adhT,cmc,rec,recw,mr,fg,slit_mr,rp,rn,total]=ids, t=`\n\n---\n\nLINE ${no}\n\nPersiapan Produksi:\n`;
  if(g(pulp))t+=`- Pulp Tank: ${g(pulp)} set\n`; if(g(vitA))t+=`- Vitacel A: ${g(vitA)} set\n`; if(g(vitB))t+=`- Vitacel B: ${g(vitB)} set\n`;
  if(g(vitS))t+=`- Vitacel Standby: ${g(vitS)} set\n`; if(g(adhS))t+=`- Adhesive Standby: ${g(adhS)} set\n`; if(g(adhT))t+=`- Adhesive Tangki: ${g(adhT)} set\n`;
  if(g(cmc))t+=`- CMC: ${g(cmc)} set\n`; if(g(rec)&&g(recw))t+=`- Recycle: ${g(rec)} set (${g(recw)} kg/set)\n`;
  t+=`\nFinish Good:\n`; if(g(mr))t+=`- Mother Roll: ${g(mr)} MR\n`; if(g(fg))t+=`- Berat FG: ${g(fg)} kg\n`;
  let totalBobin=n(slit_mr)*BOBIN_PER_MR, rej=n(rp), rejNCP=n(rn), totalManual=n(total);
  let oke=Math.max(totalBobin-rej,0), okeKg=oke*KG_PER_BOBIN;
  t+=`\nSlitting:\n- Slitting: ${totalBobin} bobin\n- Reject Produksi: ${rej} bobin\n- OKE: ${oke} bobin (${okeKg} kg)\n- Reject NCP: ${rejNCP} bobin\n- Total Manual: ${totalManual} bobin (${totalManual*KG_PER_BOBIN} kg)\n`;
  t+=`\nðŸ“ˆ OEE: ${nf.format(calcOEE(no)||0)}%\n`; return t;
}
function previewLaporan(){
  let isi=`LAPORAN SHIFT ${g('shift')}\nTanggal: ${g('tanggal')}\nProduk: ${g('produk')}`;
  let l2=['pulp205_2','vit2a','vit2b','vit2s','adh2s','adh2t','cmc2','rec2','rec2w','mr2','fg2','slit_mr2','reject_produksi2','reject_ncp2','total_bobin_manual2'];
  let l3=['pulp204_3','vit3a','vit3b','vit3s','adh3s','adh3t','cmc3','rec3','rec3w','mr3','fg3','slit_mr3','reject_produksi3','reject_ncp3','total_bobin_manual3'];
  if(isFilled(l2))isi+=narasi(2,l2); if(isFilled(l3))isi+=narasi(3,l3);
  if(g('pulp203')||g('catatan')){isi+=`\n\nCatatan:\n`; if(g('pulp203'))isi+=`- Pulp 203: ${g('pulp203')} set\n`; if(g('catatan'))isi+=`- ${g('catatan')}\n`}
  document.getElementById('output').innerText=isi; updateOEE(2); updateOEE(3); saveData();
}
function copyText(){let t=document.getElementById('output').innerText; if(!t.trim())return alert('Kosong'); navigator.clipboard.writeText(t).then(()=>alert('Disalin'))}
function shareWA(){let t=document.getElementById('output').innerText||''; if(!t)previewLaporan(); window.open(`https://wa.me/?text=${encodeURIComponent(t)}`,'_blank')}
function exportCSV(){
  let rows=[['Field','Value']]; document.querySelectorAll('input,textarea').forEach(el=>rows.push([el.id,el.value]));
  let csv=rows.map(r=>r.map(c=>`"${c}"`).join(',')).join('\n');
  let a=document.createElement('a'); a.href=URL.createObjectURL(new Blob([csv],{type:'text/csv'})); a.download='laporan.csv'; a.click();
}
function clearData(){if(!confirm('Hapus semua data?'))return; document.querySelectorAll('input,textarea').forEach(el=>el.value=''); localStorage.clear(); document.getElementById('output').innerText=''}
function toggleTheme(){document.body.classList.toggle('dark'); localStorage.setItem('theme',document.body.classList.contains('dark')?'dark':'light')}
function saveData(){let d={}; document.querySelectorAll('input,textarea').forEach(el=>d[el.id]=el.value); localStorage.setItem('formData',JSON.stringify(d))}
function restore(){let d=JSON.parse(localStorage.getItem('formData')||'{}'); Object.keys(d).forEach(k=>{let el=document.getElementById(k); if(el)el.value=d[k]}); if(localStorage.getItem('theme')==='dark')document.body.classList.add('dark')}
restore();
</script>
</body>
</html>